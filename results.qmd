# Results


Possible 10 Charts based on Problem Set1
hitogram / facets (ps1)
boxplot jitter (ps1)
with ridgeline (ps1)
density lines
bar chart lump facet
scattter plot
Density plot
geom_point with facet 9x9 grid (ps2 california)
Cleveland dot plot
ggparcords
parcoords
likert
mosaic
alluvium
11


<!-- https://data.cityofnewyork.us/City-Government/Citywide-Payroll-Data-Fiscal-Year-/k397-673e/about_data -->


```{r}
#| echo: false

rm(list = ls())
```

```{r}
#| echo: false
#| message: false
#| warning: false

# Import Libraries
library(tibble)
library(knitr)
library(kableExtra)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(visdat)
# library(HH)
library(lubridate)
```



```{r}
# Read the data RDS
payroll_data_fire_police <- readRDS("data_source/payroll_data_fire_police.rds")
```



```{r}
payroll_data_fire_police <-
  payroll_data_fire_police |> 
  mutate(agency_start_date_year = year(agency_start_date)) |> 
  mutate(total_paid = rowSums(across(c(regular_gross_paid, total_ot_paid, total_other_pay)),na.rm = TRUE))
```







```{r}
head(payroll_data_fire_police,5)
```

```{r}
colnames(payroll_data_fire_police)
```



```{r}
payroll_data_fire_police |>
  mutate(agency_start_date_year = lubridate::year(agency_start_date)) |> 
  filter(agency_start_date_year > 2014) |> 

# Create the bar chart
ggplot(aes(x = agency_start_date_year, fill = agency_name)) +
  geom_bar() +
  labs(
    title = "Count of Records by Agency Start Year",
    x = "Agency Start Year",
    y = "Number of Records",
    fill = "Agency Name"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  )
```




```{r}
payroll_data_fire_police |> 
  group_by(agency_name, work_location_borough) |> 
  summarise(
    Total_records = n()
  )
```


```{r}
payroll_data_fire_police |>

  group_by(work_location_borough, agency_name) |> 
  summarise(count = n(), .groups = 'drop') |> 
  pivot_wider(
    names_from = agency_name,  
    values_from = count,  
    values_fill = list(count = 0) 
  )
```




```{r}
payroll_data_fire_police |> 
  group_by(agency_name) |> 
  summarise(
    Total_records = n_distinct(work_location_borough)
  )
```


```{r}
payroll_data_fire_police |> 
  group_by(agency_name) |> 
  summarise(
    Total_records = n()
  ) 
  
```






```{r}
payroll_data_fire_police |> 
  filter(fiscal_year == "2024") |>
  filter(agency_name %in%  c(
    "DEPT OF ED PEDAGOGICAL",
    "DEPT OF ED PER SESSION TEACHER",
    "DEPT OF ED HRLY SUPPORT STAFF","DEPT OF ED PARA PROFESSIONALS",
    "DEPT OF ED PEDAGOGICAL",
    "DEPT OF ED PER DIEM TEACHERS",	
    "DEPT OF ED PER SESSION TEACHER",
    "POLICE DEPARTMENT",
    "FIRE DEPARTMENT"
    )) |> 
group_by(agency_name) |> 
  summarise(
    Total_records = n(),
    n_work_location_borough = n_distinct(work_location_borough)
  ) |> 
  arrange(desc(Total_records))
```


```{r}
payroll_data_fire_police |> 
  filter(fiscal_year == "2024") |>
  filter(agency_name %in%  c(
    "DEPT OF ED PEDAGOGICAL",
    "DEPT OF ED PER SESSION TEACHER",
    "DEPT OF ED HRLY SUPPORT STAFF","DEPT OF ED PARA PROFESSIONALS",
    "DEPT OF ED PEDAGOGICAL",
    "DEPT OF ED PER DIEM TEACHERS",	
    "DEPT OF ED PER SESSION TEACHER",
    "POLICE DEPARTMENT",
    "FIRE DEPARTMENT"
    )) |> 
group_by(agency_name,work_location_borough) |> 
  summarise(
    Total_records = n()
  ) |> 
  arrange(agency_name,work_location_borough)
```


```{r}
payroll_data_fire_police |> 
  # filter(fiscal_year == "2024") |>
  filter(agency_name %in%  c(
    "POLICE DEPARTMENT",
    "FIRE DEPARTMENT"
    )) |> 
group_by(agency_name,fiscal_year) |> 
  summarise(
    Total_records = n()
  ) |> 
  arrange(agency_name,fiscal_year)
```








```{r}
payroll_data_fire_police |> 
  filter(fiscal_year == "2024") |>
  group_by(agency_name,title_description) |> 
  summarise(
    Total_records = n()
    ,.groups = "drop"
  ) |> 
  arrange(agency_name,desc(Total_records))
```







```{r}
head(payroll_data_fire_police)
```

```{r}
payroll_data_fire_police |> 
  summarise(across(everything(), ~ sum(is.na(.))))
```

```{r}
payroll_data_fire_police |> 
  # filter(fiscal_year == "2024") |>
  group_by(fiscal_year,payroll_number) |> 
  summarise(
    Total_records = n()
  ) |> 
  arrange(fiscal_year,payroll_number)

```




```{r}
payroll_data_fire_police |> 
  # filter(fiscal_year == "2024") |>
  group_by(agency_name) |> 
  summarise(
    Total_records = n(),
    min(agency_start_date),
    max(agency_start_date)
  ) |> 
  arrange(agency_name,desc(Total_records))
```

```{r}

# good for alluvium, year start, year paid
payroll_data_fire_police |> 
  mutate(agency_start_date_year = year(agency_start_date)) |> 
  group_by(agency_start_date_year) |> 
  summarise(
    Total_records = n(),
  ) |> 
  arrange(agency_start_date_year)

```


```{r}

# good for alluvium, year start, year paid
payroll_data_fire_police |> 
  filter(agency_start_date_year == 1960)

```

```{r}

# good for alluvium, year start, year paid
payroll_data_fire_police |> 
  filter(agency_start_date_year == 2049)

```
```{r}

# good for alluvium, year start, year paid
payroll_data_fire_police |> 
  filter(last_name == 'KIRBY' & first_name =='KATHLYN')

```



```{r}
payroll_data_fire_police |> 
  filter(fiscal_year == "2024") |>
  group_by(agency_name,pay_basis) |> 
  summarise(
    Total_records = n(),
    TOTAL_total_paid = sum(total_paid),
    TOTAL_regular_gross_paid = sum(regular_gross_paid),
    TOTAL_total_ot_paid = sum(total_ot_paid),
    TOTAL_total_other_pay = sum(total_other_pay),
    PCT_total_paid = sum(total_paid) / sum(total_paid),
    PCT_regular_gross_paid = sum(regular_gross_paid)/ sum(total_paid),
    PCT_total_ot_paid = sum(total_ot_paid)/ sum(total_paid),
    PCT_total_other_pay = sum(total_other_pay)/ sum(total_paid),
    records_with_1 = sum(is.na(regular_gross_paid)),
    records_with_2 = sum(is.na(total_ot_paid)),
    records_with_3 = sum(is.na(total_other_pay)),
  ) |> 
  arrange(agency_name,pay_basis,desc(Total_records))
  # format(n=1)
  # format(scientific=TRUE)
```


```{r}
payroll_data_fire_police |> 
  filter(fiscal_year == "2024") |>
  filter(title_description == "CHAPLAIN")
  # filter(pay_basis == "Prorated Annual") 
```


remove pro_rated data
"Prorated Annual"



```{r}
payroll_data_fire_police |> 
  filter(fiscal_year > "2014") |>
  group_by(agency_name,fiscal_year) |> 
  summarise(
    Total_records = n(),
    TOTAL_total_paid = sum(total_paid),
    TOTAL_regular_gross_paid = sum(regular_gross_paid),
    TOTAL_total_ot_paid = sum(total_ot_paid),
    TOTAL_total_other_pay = sum(total_other_pay),
    PCT_total_paid = sum(total_paid) / sum(total_paid),
    PCT_regular_gross_paid = sum(regular_gross_paid)/ sum(total_paid),
    PCT_total_ot_paid = sum(total_ot_paid)/ sum(total_paid),
    PCT_total_other_pay = sum(total_other_pay)/ sum(total_paid),
    records_with_1 = sum(is.na(regular_gross_paid)),
    records_with_2 = sum(is.na(total_ot_paid)),
    records_with_3 = sum(is.na(total_other_pay)),
  ) |> 
  arrange(agency_name,fiscal_year,desc(Total_records))

```















```{r}
payroll_data_fire_police |> 
  filter(fiscal_year > "2014") |>
  group_by(agency_name,fiscal_year) |> 
  summarise(
    Total_records = n(),
    TOTAL_total_paid = n_distinct(title_description)
  ) |> 
  arrange(agency_name,fiscal_year,desc(Total_records))

```





```{r}
payroll_data_fire_police |> 
  # mutate(year_agency_start_date_clean = year(agency_start_date_clean)) |> 
  filter(agency_start_date_year == "2024") |>
  filter(fiscal_year > "2014") |>
  group_by(agency_name,title_description) |> 
  summarise(
    Total_records = n()
    ,mean(base_salary)
  ) |> 
  arrange(agency_name,desc(Total_records))

```







```{r}
payroll_data_fire_police |> 
  # mutate(year_agency_start_date_clean = year(agency_start_date_clean)) |> 
  # filter(fiscal_year == "2018") |>
  filter(title_description %in%  c("FIREFIGHTER","POLICE OFFICER")) |>
  group_by(agency_name,pay_basis,fiscal_year,title_description) |> 
  summarise(
    Total_records = n()
    ,mean(base_salary)
    ,mean(total_paid)
  ) |> 
  arrange(agency_name,desc(Total_records))

```


















































```{r}
payroll_data_fire_police |>
  # filter(title_description== "TEACHER- PER SESSION") |>
  filter(fiscal_year == "2024") |>
  filter(leave_status_as_of_june_30=="ACTIVE") |>
  filter(agency_name %in%  c("DEPT OF ED PEDAGOGICAL","DEPT OF ED PER SESSION TEACHER","DEPT OF ED HRLY SUPPORT STAFF","DEPT OF ED PARA PROFESSIONALS",
"DEPT OF ED PEDAGOGICAL",
"DEPT OF ED PER DIEM TEACHERS",
"DEPT OF ED PER SESSION TEACHER"	)) |>
  group_by(agency_name,title_description) |>
  summarise(
    Total_records = n(),
    base_salary_sum = sum(base_salary),
    base_salary_avg = mean(regular_gross_paid),
    base_salary_sum2 = sum(regular_gross_paid),
    # total_ot_sum = round(sum(total_ot_pay),0),
    total_other_sum = round(sum(total_other_pay),0),
    total_paid_sum = round(sum(total_paid),0),
    total_paid_avg = mean(total_paid),

  ) |>
  arrange(desc(Total_records))
```


```{r}
payroll_data_fire_police |>
  # filter(title_description== "TEACHER- PER SESSION") |>
  filter(fiscal_year == "2024") |>
  filter(leave_status_as_of_june_30=="ACTIVE") |>
  filter(agency_name %in%  c("POLICE DEPARTMENT"	)) |>
  group_by(agency_name,work_location_borough,title_description) |>
  summarise(
    Total_records = n(),
    base_salary_sum = sum(base_salary),
    base_salary_avg = mean(regular_gross_paid),
    base_salary_sum2 = sum(regular_gross_paid),
    # total_ot_sum = round(sum(total_ot_pay),0),
    total_other_sum = round(sum(total_other_pay),0),
    total_paid_sum = round(sum(total_paid),0),
    total_paid_avg = mean(total_paid),

  ) |>
  arrange(agency_name,title_description,work_location_borough)
  # arrange(desc(Total_records))
```


```{r}
payroll_data_fire_police |>
  # filter(title_description== "TEACHER- PER SESSION") |>
  # filter(fiscal_year == "2024") |>
  filter(leave_status_as_of_june_30=="ACTIVE") |>
  filter(agency_name %in%  c("POLICE DEPARTMENT"	)) |>
  group_by(title_description) |>
  summarise(
    Total_records = n(),
    base_salary_sum = sum(base_salary),
    base_salary_avg = mean(regular_gross_paid),
    base_salary_sum2 = sum(regular_gross_paid),
    # total_ot_sum = round(sum(total_ot_pay),0),
    total_other_sum = round(sum(total_other_pay),0),
    total_paid_sum = round(sum(total_paid),0),
    total_paid_avg = mean(total_paid),

  ) |>
  # arrange(title_description)
  arrange(desc(Total_records))
```

```{r}
payroll_data_fire_police |>
  group_by(work_location_borough) |>
  summarise(
    Total_records = n()
  )

```




```{r}
payroll_data_fire_police |>
  group_by(work_location_borough,fiscal_year) |>
  summarise(
    Total_records = n()
  )

```



```{r}
payroll_data_fire_police |>
  group_by(title_description) |>
  summarise(
    Total_records = n()
  ) |>
  arrange(desc(Total_records))

```





```{r}
payroll_data_fire_police |>
  # filter(title_description== "TEACHER- PER SESSION") |>
  # filter(fiscal_year == "2024") |>
  # filter(agency_name %in%  c("DEPT OF ED PEDAGOGICAL","DEPT OF ED PER SESSION TEACHER")) |>
  group_by(agency_name,work_location_borough) |>
  summarise(
    Total_records = n(),
    base_salary_sum = sum(base_salary),
    base_salary_avg = mean(base_salary)
  ) |>
  arrange(desc(agency_name))
```


```{r}
payroll_data_fire_police <- payroll_data_fire_police |>
  # mutate(base_salary_std = if_else(pay_basis == "per Day", base_salary * 260, base_salary) |>
  mutate(
    regular_gross_paid = as.numeric(regular_gross_paid),
    total_ot_paid = as.numeric(total_ot_paid),
    total_other_pay = as.numeric(total_other_pay)
  ) |>
  mutate(total_paid = regular_gross_paid +total_ot_paid + total_other_pay)
```


```{r}
head(payroll_data_fire_police)
```


```{r}
payroll_data_fire_police |>
    filter(fiscal_year == "2024") |>
  # filter(agency_name %in%  c("DEPT OF ED PEDAGOGICAL","DEPT OF ED PER SESSION TEACHER")) |>

ggplot() +
    geom_point(mapping = aes(x=base_salary,
                             y=regular_gross_paid,
                             color = pay_basis
                             ),
      size = 0.5,
      alpha = 0.5,
      )
```


```{r}
payroll_data_fire_police |>
    filter(fiscal_year == "2024") |>
  # filter(agency_name %in%  c("DEPT OF ED PEDAGOGICAL","DEPT OF ED PER SESSION TEACHER")) |>

ggplot() +
    geom_point(mapping = aes(x=total_paid,
                             y=regular_gross_paid,
                             color = leave_status_as_of_june_30
                             ),
      size = 0.5,
      alpha = 0.5,
      )+
   scale_x_continuous(labels = scales::label_comma()) +
  scale_y_continuous(labels = scales::label_comma()) +
  coord_fixed()
```

```{r}
payroll_data_fire_police |>
  filter(fiscal_year == "2024") |>
  # filter(agency_name %in%  c("DEPT OF ED PEDAGOGICAL","DEPT OF ED PER SESSION TEACHER")) |>

ggplot() +
    geom_point(mapping = aes(x=regular_gross_paid,
                             y=total_other_pay,
                             color = leave_status_as_of_june_30
                             ),
      size = 0.5,
      alpha = 0.5,
      )+
   scale_x_continuous(labels = scales::label_comma()) +
  scale_y_continuous(labels = scales::label_comma()) +
  coord_fixed()
```


